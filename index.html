<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NECMIS - Northeast Construction Market Intelligence</title>
    <style>
        /* ============================================
           NECMIS Dashboard - PRD Compliant
           Display Order: Stats ‚Üí DOT Lettings ‚Üí News
           ============================================ */
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #2d4a7c 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* Password Overlay - PRD Requirement #3: 10 users, shared password */
        #password-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a365d 0%, #2d4a7c 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .password-box {
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
        }
        
        .password-box h2 {
            color: #1a365d;
            margin-bottom: 8px;
            font-size: 1.5em;
        }
        
        .password-box p {
            color: #666;
            margin-bottom: 24px;
            font-size: 0.9em;
        }
        
        .password-box input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
        }
        
        .password-box input:focus {
            outline: none;
            border-color: #3182ce;
        }
        
        .password-box button {
            width: 100%;
            padding: 14px;
            background: #3182ce;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .password-box button:hover {
            background: #2c5aa0;
        }
        
        .password-error {
            color: #e53e3e;
            margin-top: 12px;
            display: none;
        }
        
        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: none; /* Hidden until authenticated */
        }
        
        /* Header */
        .header {
            background: rgba(255,255,255,0.98);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .header h1 {
            color: #1a365d;
            font-size: 1.8em;
        }
        
        .header-date {
            color: #666;
            font-size: 0.95em;
        }
        
        /* ============================================
           SECTION 1: STATISTICS (FIRST per PRD #5)
           Shows $ amounts and counts prominently
           ============================================ */
        .stats-section {
            background: rgba(255,255,255,0.98);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .stats-section h2 {
            color: #1a365d;
            font-size: 1.3em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #3182ce 0%, #2c5aa0 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-card.highlight {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }
        
        .stat-card.warning {
            background: linear-gradient(135deg, #d69e2e 0%, #b7791f 100%);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
        }
        
        /* ============================================
           MARKET HEALTH FRAMEWORK (PRD #6, #8)
           Scores + Actions + Trends (Option C)
           ============================================ */
        .market-health-section {
            background: rgba(255,255,255,0.98);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .market-health-section h2 {
            color: #1a365d;
            font-size: 1.3em;
            margin-bottom: 8px;
        }
        
        .overall-score {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: #f7fafc;
            border-radius: 12px;
        }
        
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            color: white;
        }
        
        .score-circle.growth { background: linear-gradient(135deg, #38a169, #2f855a); }
        .score-circle.stable { background: linear-gradient(135deg, #3182ce, #2c5aa0); }
        .score-circle.watchlist { background: linear-gradient(135deg, #d69e2e, #b7791f); }
        .score-circle.defensive { background: linear-gradient(135deg, #e53e3e, #c53030); }
        
        .score-circle .score-num {
            font-size: 1.8em;
            line-height: 1;
        }
        
        .score-circle .score-max {
            font-size: 0.7em;
            opacity: 0.8;
        }
        
        .overall-info h3 {
            font-size: 1.2em;
            color: #1a365d;
            margin-bottom: 4px;
        }
        
        .overall-info p {
            color: #666;
            font-size: 0.9em;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .metric-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 14px;
            border-left: 4px solid #3182ce;
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .metric-name {
            font-weight: 600;
            color: #1a365d;
            font-size: 0.9em;
        }
        
        .metric-score-trend {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .metric-score {
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .trend-up { color: #38a169; }
        .trend-down { color: #e53e3e; }
        .trend-stable { color: #d69e2e; }
        
        .metric-action {
            font-size: 0.8em;
            color: #4a5568;
            background: white;
            padding: 6px 10px;
            border-radius: 6px;
            margin-top: 8px;
        }
        
        /* ============================================
           SECTION 2: DOT LETTINGS (SECOND per PRD #5)
           ============================================ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .feed-section {
            background: rgba(255,255,255,0.98);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .feed-section h2 {
            color: #1a365d;
            font-size: 1.3em;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feed-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .feed-tab {
            padding: 8px 16px;
            border: none;
            background: #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.2s;
        }
        
        .feed-tab:hover {
            background: #cbd5e0;
        }
        
        .feed-tab.active {
            background: #3182ce;
            color: white;
        }
        
        .feed-content {
            display: none;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .feed-content.active {
            display: block;
        }
        
        /* DOT Letting Item */
        .dot-item {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-left: 4px solid #38a169;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s;
        }
        
        .dot-item:hover {
            transform: translateX(4px);
        }
        
        .dot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .dot-state {
            background: #38a169;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .dot-cost {
            font-weight: 700;
            color: #276749;
            font-size: 1.1em;
        }
        
        .dot-title {
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .dot-meta {
            display: flex;
            gap: 16px;
            font-size: 0.8em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .dot-link {
            display: inline-block;
            color: #3182ce;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .dot-link:hover {
            text-decoration: underline;
        }
        
        /* News Item (THIRD per PRD #5) */
        .news-item {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-left: 4px solid #3182ce;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s;
        }
        
        .news-item:hover {
            transform: translateX(4px);
        }
        
        .news-item.funding {
            border-left-color: #d69e2e;
            background: #fffff0;
        }
        
        .news-item.high-priority {
            border-left-color: #e53e3e;
        }
        
        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .news-source {
            font-weight: 600;
            color: #3182ce;
            font-size: 0.85em;
        }
        
        .news-state {
            background: #e2e8f0;
            color: #4a5568;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .news-title {
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 6px;
            font-size: 0.95em;
        }
        
        .news-summary {
            color: #4a5568;
            font-size: 0.85em;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .news-date {
            color: #a0aec0;
            font-size: 0.8em;
        }
        
        .news-link {
            display: inline-block;
            color: #3182ce;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .news-link:hover {
            text-decoration: underline;
        }
        
        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .sidebar-card {
            background: rgba(255,255,255,0.98);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .sidebar-card h3 {
            color: #1a365d;
            font-size: 1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* State Breakdown */
        .state-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .state-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #f7fafc;
            border-radius: 6px;
        }
        
        .state-name {
            font-weight: 600;
            color: #1a365d;
        }
        
        .state-count {
            background: #3182ce;
            color: white;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        /* DOT Portals */
        .portal-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .portal-link {
            display: block;
            padding: 10px;
            background: #f7fafc;
            border-radius: 6px;
            text-decoration: none;
            color: #1a365d;
            font-size: 0.85em;
            transition: background 0.2s;
        }
        
        .portal-link:hover {
            background: #e2e8f0;
        }
        
        .portal-link strong {
            display: block;
            margin-bottom: 2px;
        }
        
        .portal-link span {
            color: #718096;
            font-size: 0.85em;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            font-size: 0.85em;
        }
        
        .footer a {
            color: rgba(255,255,255,0.9);
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #3182ce;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .sidebar-card {
                flex: 1;
                min-width: 250px;
            }
        }
        
        @media (max-width: 600px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 1.5em;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Password Overlay - PRD Requirement #3 -->
    <div id="password-overlay">
        <div class="password-box">
            <h2>üîê NECMIS Access</h2>
            <p>Northeast Construction Market Intelligence System</p>
            <input type="password" id="password-input" placeholder="Enter password" onkeypress="if(event.key==='Enter')checkPassword()">
            <button onclick="checkPassword()">Access Dashboard</button>
            <p class="password-error" id="password-error">Incorrect password. Please try again.</p>
        </div>
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="container" id="main-container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <h1>üìä NECMIS - Market Intelligence</h1>
                <div class="header-date" id="header-date"></div>
            </div>
            <div style="color: #666; font-size: 0.9em;">
                Northeast Construction Market Intelligence System | VT ‚Ä¢ NH ‚Ä¢ ME ‚Ä¢ MA ‚Ä¢ NY ‚Ä¢ RI ‚Ä¢ CT ‚Ä¢ PA
            </div>
        </div>
        
        <!-- SECTION 1: STATISTICS (FIRST per PRD #5) -->
        <div class="stats-section">
            <h2>üí∞ Pipeline Statistics</h2>
            <div class="stats-grid" id="stats-grid">
                <div class="loading">Loading statistics...</div>
            </div>
        </div>
        
        <!-- MARKET HEALTH FRAMEWORK (PRD #6, #8) -->
        <div class="market-health-section">
            <h2>üìà Market Health Framework</h2>
            <p style="color: #666; font-size: 0.85em; margin-bottom: 16px;">6 Public Metrics | Scores + Trends + Actions</p>
            <div id="market-health-content">
                <div class="loading">Loading market health data...</div>
            </div>
        </div>
        
        <!-- Main Content: DOT Lettings (SECOND) + News (THIRD) -->
        <div class="main-content">
            <div class="feed-section">
                <h2>üìã Intelligence Feed</h2>
                
                <!-- Feed Tabs -->
                <div class="feed-tabs">
                    <button class="feed-tab active" onclick="showFeed('lettings')">üèóÔ∏è DOT Lettings</button>
                    <button class="feed-tab" onclick="showFeed('news')">üì∞ News</button>
                    <button class="feed-tab" onclick="showFeed('funding')">üíµ Funding</button>
                    <button class="feed-tab" onclick="showFeed('all')">All</button>
                </div>
                
                <!-- Feed Contents -->
                <div id="feed-lettings" class="feed-content active">
                    <div class="loading">Loading DOT lettings...</div>
                </div>
                <div id="feed-news" class="feed-content">
                    <div class="loading">Loading news...</div>
                </div>
                <div id="feed-funding" class="feed-content">
                    <div class="loading">Loading funding news...</div>
                </div>
                <div id="feed-all" class="feed-content">
                    <div class="loading">Loading all items...</div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- State Breakdown -->
                <div class="sidebar-card">
                    <h3>üìä By State</h3>
                    <div class="state-list" id="state-breakdown">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
                
                <!-- DOT Portals - PRD Section 3.1 -->
                <div class="sidebar-card">
                    <h3>üîó DOT Bid Portals</h3>
                    <div class="portal-list">
                        <a href="https://vtrans.vermont.gov/contract-admin/bids-requests/construction-contracting" target="_blank" class="portal-link">
                            <strong>VT - VTrans</strong>
                            <span>Construction Contracting</span>
                        </a>
                        <a href="https://www.dot.nh.gov/doing-business-nhdot/contractors/invitation-bid" target="_blank" class="portal-link">
                            <strong>NH - NHDOT</strong>
                            <span>Invitation to Bid</span>
                        </a>
                        <a href="https://www.maine.gov/mdot/projects/advertised/" target="_blank" class="portal-link">
                            <strong>ME - MaineDOT</strong>
                            <span>Advertised Projects</span>
                        </a>
                        <a href="https://hwy.massdot.state.ma.us/webapps/const/statusReport.asp" target="_blank" class="portal-link">
                            <strong>MA - MassDOT</strong>
                            <span>Status Report</span>
                        </a>
                        <a href="https://www.dot.ny.gov/doing-business/opportunities/const-highway" target="_blank" class="portal-link">
                            <strong>NY - NYSDOT</strong>
                            <span>Highway Construction</span>
                        </a>
                        <a href="https://www.dot.ri.gov/about/current_projects.php" target="_blank" class="portal-link">
                            <strong>RI - RIDOT</strong>
                            <span>Current Projects</span>
                        </a>
                        <a href="https://portal.ct.gov/DOT/Doing-Business/Contractor-Information" target="_blank" class="portal-link">
                            <strong>CT - CTDOT</strong>
                            <span>Contractor Information</span>
                        </a>
                        <a href="https://www.penndot.pa.gov/business/Letting/Pages/default.aspx" target="_blank" class="portal-link">
                            <strong>PA - PennDOT</strong>
                            <span>Letting Information</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p><strong>NECMIS - Northeast Construction Market Intelligence System</strong></p>
            <p>Data Sources: State DOT Portals (8 states) | Regional News RSS (10 feeds) | Market Health Framework (6 public metrics)</p>
            <p>Last Updated: <span id="last-updated">--</span></p>
        </div>
    </div>
    
    <script>
        // ============================================
        // PASSWORD PROTECTION - PRD Requirement #3
        // Password: NECMIS2026!
        // ============================================
        const CORRECT_PASSWORD = 'NECMIS2026!';
        
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if (input === CORRECT_PASSWORD) {
                document.getElementById('password-overlay').style.display = 'none';
                document.getElementById('main-container').style.display = 'block';
                loadData();
            } else {
                document.getElementById('password-error').style.display = 'block';
                document.getElementById('password-input').value = '';
            }
        }
        
        // ============================================
        // DATA LOADING
        // ============================================
        let dashboardData = null;
        
        async function loadData() {
            try {
                // Try to load from data/necmis_data.json
                const response = await fetch('data/necmis_data.json');
                if (!response.ok) throw new Error('Data file not found');
                dashboardData = await response.json();
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                // Try alternative path
                try {
                    const altResponse = await fetch('./necmis_data.json');
                    if (!altResponse.ok) throw new Error('Alt data file not found');
                    dashboardData = await altResponse.json();
                    renderDashboard();
                } catch (altError) {
                    console.error('Error loading alt data:', altError);
                    showError('Unable to load data. Please check data/necmis_data.json exists.');
                }
            }
        }
        
        function showError(message) {
            document.getElementById('stats-grid').innerHTML = `<div class="empty-state">${message}</div>`;
            document.getElementById('market-health-content').innerHTML = `<div class="empty-state">${message}</div>`;
            document.getElementById('feed-lettings').innerHTML = `<div class="empty-state">${message}</div>`;
        }
        
        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function renderDashboard() {
            if (!dashboardData) return;
            
            // Set date
            document.getElementById('header-date').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            document.getElementById('last-updated').textContent = new Date(dashboardData.generated).toLocaleString();
            
            // Render each section
            renderStats();
            renderMarketHealth();
            renderFeeds();
            renderStateBreakdown();
        }
        
        // SECTION 1: STATISTICS (FIRST per PRD #5)
        function renderStats() {
            const summary = dashboardData.summary;
            const html = `
                <div class="stat-card highlight">
                    <div class="stat-value">${formatCurrency(summary.total_value_low)} - ${formatCurrency(summary.total_value_high)}</div>
                    <div class="stat-label">Pipeline Value Range</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${summary.total_opportunities}</div>
                    <div class="stat-label">Total Opportunities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${summary.by_category.dot_letting}</div>
                    <div class="stat-label">DOT Lettings</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value">${summary.by_category.funding}</div>
                    <div class="stat-label">Funding Announcements</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${summary.by_category.news}</div>
                    <div class="stat-label">News Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${dashboardData.dot_lettings.length + dashboardData.news.length}</div>
                    <div class="stat-label">Total Items</div>
                </div>
            `;
            document.getElementById('stats-grid').innerHTML = html;
        }
        
        // MARKET HEALTH FRAMEWORK (PRD #6, #8)
        function renderMarketHealth() {
            const mh = dashboardData.market_health;
            
            // Metric labels (matching PRD)
            const metricLabels = {
                dot_pipeline: { name: 'DOT Project Pipeline', weight: '15%' },
                housing_permits: { name: 'Housing Permit Momentum', weight: '10%' },
                construction_spending: { name: 'Construction Spending', weight: '10%' },
                migration: { name: 'Migration Patterns', weight: '10%' },
                input_cost_stability: { name: 'Input Cost Stability', weight: '8%' },
                infrastructure_funding: { name: 'Infrastructure Funding', weight: '7%' }
            };
            
            // Build metrics HTML
            let metricsHtml = '';
            for (const [key, label] of Object.entries(metricLabels)) {
                const metric = mh[key];
                if (!metric) continue;
                
                const trendIcon = metric.trend === 'up' ? '‚Üë' : (metric.trend === 'down' ? '‚Üì' : '‚Üí');
                const trendClass = metric.trend === 'up' ? 'trend-up' : (metric.trend === 'down' ? 'trend-down' : 'trend-stable');
                
                metricsHtml += `
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-name">${label.name} (${label.weight})</span>
                            <div class="metric-score-trend">
                                <span class="metric-score">${metric.score}/10</span>
                                <span class="${trendClass}">${trendIcon}</span>
                            </div>
                        </div>
                        <div class="metric-action">‚Üí ${metric.action}</div>
                    </div>
                `;
            }
            
            const html = `
                <div class="overall-score">
                    <div class="score-circle ${mh.overall_status}">
                        <span class="score-num">${mh.overall_score}</span>
                        <span class="score-max">/10</span>
                    </div>
                    <div class="overall-info">
                        <h3>Overall Market Health: ${mh.overall_status.toUpperCase()}</h3>
                        <p>${getStatusDescription(mh.overall_status)}</p>
                    </div>
                </div>
                <div class="metrics-grid">
                    ${metricsHtml}
                </div>
            `;
            document.getElementById('market-health-content').innerHTML = html;
        }
        
        function getStatusDescription(status) {
            const descriptions = {
                growth: '> 7.5 ‚Äî Expand capacity, pursue aggressive growth',
                stable: '6.0 - 7.5 ‚Äî Maintain position, selective investments',
                watchlist: '5.0 - 6.0 ‚Äî Monitor closely, focus on efficiency',
                defensive: '< 5.0 ‚Äî Cost focus, protect existing business'
            };
            return descriptions[status] || '';
        }
        
        // FEEDS: DOT Lettings (SECOND), News (THIRD) per PRD #5
        function renderFeeds() {
            // DOT Lettings
            const lettingsHtml = dashboardData.dot_lettings.map(item => `
                <div class="dot-item">
                    <div class="dot-header">
                        <span class="dot-state">${item.state}</span>
                        <span class="dot-cost">${item.cost_display || 'Cost TBD'}</span>
                    </div>
                    <div class="dot-title">${item.description}</div>
                    <div class="dot-meta">
                        ${item.project_id ? `<span>Project: ${item.project_id}</span>` : ''}
                        ${item.let_date ? `<span>Letting: ${formatDate(item.let_date)}</span>` : ''}
                        ${item.project_type ? `<span>Type: ${item.project_type}</span>` : ''}
                    </div>
                    <a href="${item.url}" target="_blank" class="dot-link">View on ${item.source} ‚Üí</a>
                </div>
            `).join('');
            document.getElementById('feed-lettings').innerHTML = lettingsHtml || '<div class="empty-state">No DOT lettings available</div>';
            
            // News (non-funding)
            const newsItems = dashboardData.news.filter(item => item.category === 'news');
            const newsHtml = newsItems.map(item => renderNewsItem(item)).join('');
            document.getElementById('feed-news').innerHTML = newsHtml || '<div class="empty-state">No news items available</div>';
            
            // Funding
            const fundingItems = dashboardData.news.filter(item => item.category === 'funding');
            const fundingHtml = fundingItems.map(item => renderNewsItem(item)).join('');
            document.getElementById('feed-funding').innerHTML = fundingHtml || '<div class="empty-state">No funding announcements available</div>';
            
            // All
            const allHtml = lettingsHtml + dashboardData.news.map(item => renderNewsItem(item)).join('');
            document.getElementById('feed-all').innerHTML = allHtml || '<div class="empty-state">No items available</div>';
        }
        
        function renderNewsItem(item) {
            const priorityClass = item.priority === 'high' ? 'high-priority' : '';
            const categoryClass = item.category === 'funding' ? 'funding' : '';
            
            return `
                <div class="news-item ${priorityClass} ${categoryClass}">
                    <div class="news-header">
                        <span class="news-source">${item.source}</span>
                        <span class="news-state">${item.state}</span>
                    </div>
                    <div class="news-title">${item.title}</div>
                    ${item.summary ? `<div class="news-summary">${item.summary}</div>` : ''}
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="news-date">${formatDate(item.date)}</span>
                        <a href="${item.url}" target="_blank" class="news-link">Read Article ‚Üí</a>
                    </div>
                </div>
            `;
        }
        
        function renderStateBreakdown() {
            const byState = dashboardData.summary.by_state;
            const states = ['VT', 'NH', 'ME', 'MA', 'NY', 'RI', 'CT', 'PA'];
            
            const html = states.map(state => `
                <div class="state-row">
                    <span class="state-name">${state}</span>
                    <span class="state-count">${byState[state] || 0}</span>
                </div>
            `).join('');
            
            document.getElementById('state-breakdown').innerHTML = html;
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatCurrency(amount) {
            if (!amount) return '$0';
            if (amount >= 1000000000) return '$' + (amount / 1000000000).toFixed(1) + 'B';
            if (amount >= 1000000) return '$' + (amount / 1000000).toFixed(0) + 'M';
            if (amount >= 1000) return '$' + (amount / 1000).toFixed(0) + 'K';
            return '$' + amount.toLocaleString();
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function showFeed(feedType) {
            // Update tabs
            document.querySelectorAll('.feed-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.feed-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`feed-${feedType}`).classList.add('active');
        }
        
        // ============================================
        // INITIALIZE
        // ============================================
        document.getElementById('password-input').focus();
    </script>
</body>
</html>
